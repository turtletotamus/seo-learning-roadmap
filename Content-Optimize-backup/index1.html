<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="事業計畫">
    <meta name="theme-color" content="#0a0a0a">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>Raymond 事業計畫</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --black: #0a0a0a;
            --dark: #1a1a1a;
            --gray-900: #262626;
            --gray-800: #333333;
            --gray-700: #404040;
            --gray-600: #525252;
            --gray-500: #737373;
            --gray-400: #a3a3a3;
            --gray-300: #d4d4d4;
            --gray-200: #e5e5e5;
            --gray-100: #f5f5f5;
            --white: #fafafa;
            --danger: #991b1b;
            --warning: #92400e;
            --success: #166534;
            --tab-height: 56px;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Noto Sans TC', -apple-system, sans-serif;
            background: var(--white);
            color: var(--black);
            line-height: 1.7;
            font-size: 15px;
        }

        .app {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding-top: var(--safe-top);
            padding-bottom: calc(var(--tab-height) + var(--safe-bottom) + 20px);
        }

        .tab-content {
            display: none;
            padding: 20px 20px 24px;
            min-height: 100%;
        }

        .tab-content.active {
            display: block;
        }

        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: calc(var(--tab-height) + var(--safe-bottom));
            padding-bottom: var(--safe-bottom);
            background: var(--black);
            display: flex;
            border-top: none;
            z-index: 100;
        }

        .tab-item {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            height: var(--tab-height);
            color: var(--gray-500);
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 400;
            letter-spacing: 0.02em;
            cursor: pointer;
            transition: color 0.2s;
        }

        .tab-item.active {
            color: var(--white);
            background: var(--gray-900);
        }

        .header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--black);
        }

        .header-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 6px;
        }

        .header h1 {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        /* Pinned section */
        .pinned {
            background: var(--black);
            color: var(--white);
            padding: 20px;
            margin-bottom: 20px;
        }

        .pinned-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            color: var(--gray-400);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 12px;
        }

        .pinned-content {
            font-size: 0.95rem;
            line-height: 1.8;
        }

        .pinned-content p {
            margin-bottom: 12px;
        }

        .pinned-content p:last-child {
            margin-bottom: 0;
        }

        .quote-source {
            font-size: 0.8rem;
            color: var(--gray-400);
            margin-top: 8px;
        }

        /* Cards */
        .card {
            border: 1px solid var(--gray-300);
            margin-bottom: 12px;
        }

        .card-header {
            padding: 14px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            background: var(--gray-100);
            border-bottom: 1px solid var(--gray-300);
        }

        .card-header:active {
            background: var(--gray-200);
        }

        .card.open .card-header {
            background: var(--black);
            color: var(--white);
            border-bottom-color: var(--black);
        }

        .card-title {
            font-weight: 500;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .card-arrow {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            transition: transform 0.2s;
        }

        .card.open .card-arrow {
            transform: rotate(90deg);
        }

        .card-body {
            display: none;
            padding: 16px;
        }

        .card.open .card-body {
            display: block;
        }

        .section {
            padding: 14px 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .section:first-child {
            padding-top: 0;
        }

        .section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .section-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            font-weight: 500;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 10px;
        }

        ul {
            list-style: none;
        }

        ul li {
            padding: 5px 0;
            padding-left: 14px;
            position: relative;
            color: var(--gray-700);
            font-size: 0.9rem;
        }

        ul li::before {
            content: "—";
            position: absolute;
            left: 0;
            color: var(--gray-400);
        }

        .highlight {
            background: var(--gray-100);
            padding: 14px;
            margin: 10px 0;
        }

        .highlight.dark {
            background: var(--dark);
            color: var(--white);
        }

        .highlight p {
            margin: 0;
            font-size: 0.9rem;
        }

        .highlight.dark p {
            color: var(--gray-300);
        }

        .highlight strong {
            color: var(--white);
        }

        /* Product cards */
        .product-card {
            border: 1px solid var(--gray-200);
            padding: 14px;
            margin-bottom: 10px;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .product-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .product-price {
            font-family: 'JetBrains Mono', monospace;
            background: var(--black);
            color: var(--white);
            padding: 2px 8px;
            font-size: 0.75rem;
        }

        .product-details {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .product-details li {
            padding: 3px 0;
        }

        /* Checklist */
        .phase {
            margin-bottom: 28px;
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-300);
        }

        .phase-badge {
            font-family: 'JetBrains Mono', monospace;
            background: var(--black);
            color: var(--white);
            padding: 3px 8px;
            font-size: 0.6rem;
            letter-spacing: 0.05em;
        }

        .phase-title {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .week-group {
            margin-bottom: 16px;
        }

        .week-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            padding-left: 4px;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            padding: 12px 14px;
            background: var(--gray-100);
            margin-bottom: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checklist-item:active {
            background: var(--gray-200);
        }

        .checklist-item.done {
            background: var(--white);
            border: 1px solid var(--gray-200);
        }

        .checklist-item.done .checklist-text {
            text-decoration: line-through;
            color: var(--gray-400);
        }

        .checkbox {
            width: 16px;
            height: 16px;
            border: 1px solid var(--gray-400);
            margin-right: 12px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            color: transparent;
            transition: all 0.2s;
            margin-top: 2px;
        }

        .checklist-item.done .checkbox {
            background: var(--black);
            border-color: var(--black);
            color: var(--white);
        }

        .checklist-text {
            flex: 1;
            font-size: 0.85rem;
        }

        .checklist-delete {
            color: var(--gray-400);
            font-size: 0.8rem;
            padding: 0 8px;
            cursor: pointer;
        }

        .checklist-delete:hover {
            color: var(--danger);
        }

        .add-item-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background: none;
            border: 1px dashed var(--gray-300);
            color: var(--gray-500);
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 8px;
        }

        .add-item-btn:active {
            background: var(--gray-100);
        }

        /* Metrics */
        .metrics-section {
            margin-bottom: 24px;
        }

        .metrics-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            font-weight: 500;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--gray-200);
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--gray-100);
            font-size: 0.85rem;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: var(--gray-600);
        }

        .metric-value {
            font-weight: 500;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .metric-value.danger {
            color: var(--danger);
        }

        .metric-value.warning {
            color: var(--warning);
        }

        .metric-value.success {
            color: var(--success);
        }

        .metric-value.editable {
            background: var(--gray-100);
            padding: 4px 8px;
            cursor: pointer;
        }

        .metric-sub {
            font-size: 0.8rem;
            color: var(--gray-500);
            padding-left: 14px;
            margin-top: 4px;
        }

        /* Client list */
        .client-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .client-item:last-child {
            border-bottom: none;
        }

        .client-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .client-amount {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        .client-percent {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-left: 8px;
        }

        .client-percent.danger {
            color: var(--danger);
        }

        /* Joe's table */
        .joe-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }

        .joe-table th,
        .joe-table td {
            padding: 10px 6px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
            vertical-align: top;
        }

        .joe-table th {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            color: var(--gray-500);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .joe-table td:first-child {
            font-weight: 500;
            width: 40%;
        }

        .joe-table td:nth-child(2) {
            text-align: center;
            width: 15%;
        }

        .joe-table td:nth-child(3) {
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .status-good { color: var(--success); }
        .status-warning { color: var(--warning); }
        .status-bad { color: var(--danger); }

        /* Discussion tab */
        .discuss-card {
            border: 1px solid var(--gray-300);
            padding: 40px 20px;
            text-align: center;
        }

        .discuss-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .discuss-desc {
            color: var(--gray-600);
            font-size: 0.85rem;
            margin-bottom: 24px;
            line-height: 1.7;
        }

        .discuss-btn {
            display: inline-block;
            background: var(--black);
            color: var(--white);
            padding: 14px 36px;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.85rem;
            letter-spacing: 0.02em;
        }

        .discuss-btn:active {
            background: var(--gray-800);
        }

        .discuss-note {
            margin-top: 16px;
            font-size: 0.75rem;
            color: var(--gray-400);
        }

        /* Alert box */
        .alert {
            background: var(--gray-100);
            padding: 14px;
            margin-top: 16px;
            font-size: 0.85rem;
        }

        .alert.danger {
            background: #fef2f2;
            border-left: 3px solid var(--danger);
        }

        .alert.warning {
            background: #fffbeb;
            border-left: 3px solid var(--warning);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--white);
            width: 100%;
            max-width: 360px;
            padding: 24px;
        }

        .modal-title {
            font-weight: 600;
            margin-bottom: 16px;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-300);
            font-size: 0.9rem;
            margin-bottom: 12px;
            font-family: inherit;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--black);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            font-size: 0.85rem;
            cursor: pointer;
            font-family: inherit;
        }

        .modal-btn.primary {
            background: var(--black);
            color: var(--white);
        }

        .modal-btn.secondary {
            background: var(--gray-200);
            color: var(--black);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray-500);
        }

        /* Target display */
        .target-display {
            font-size: 0.75rem;
            color: var(--gray-400);
        }
    </style>
</head>
<body>
    <div class="app">
        <main class="main-content">
            <!-- Tab 1: 策略 -->
            <div id="tab-strategy" class="tab-content active">
                <div class="header">
                    <div class="header-label">Strategy</div>
                    <h1>策略</h1>
                </div>

                <!-- 原則（釘選） -->
                <div class="pinned">
                    <div class="pinned-label">核心原則</div>
                    <div class="pinned-content">
                        <p>「重劍無鋒，大巧不工。投入時間，走在對的路上，終究能透過積累來獲得回報。」</p>
                        <div class="quote-source">— Joe 第49集</div>
                        <p style="margin-top: 16px;"><strong>定價公式：</strong>合宜報價 = 直接投入 + 商談準備 + 風險溢價 + 機會成本</p>
                        <p><strong>客戶組合：</strong>單一客戶絕對不超過 25%</p>
                        <p><strong>代操底線：</strong>代操費 = 顧問費 × 2.5 倍</p>
                    </div>
                </div>

                <!-- 創伴人定位 -->
                <div class="card" data-card="positioning">
                    <div class="card-header">
                        <span class="card-title">創伴人定位</span>
                        <span class="card-arrow">→</span>
                    </div>
                    <div class="card-body">
                        <div class="section">
                            <div class="section-title">核心定位</div>
                            <div class="highlight dark">
                                <p><strong>「專門幫助不懂網路的傳統老闆與新創業者，用 SEO 帶來客戶的陪伴式顧問」</strong></p>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">目標客群</div>
                            <ul>
                                <li><strong>60% 二代接班人</strong> — 30-40歲，剛接班1-3年，想證明自己</li>
                                <li><strong>30% 新創業者</strong> — 25-35歲，創業1-2年，預算有限但願意學</li>
                                <li><strong>10% 傳統老闆</strong> — 40-60歲，決策慢但預算高</li>
                            </ul>
                        </div>

                        <div class="section">
                            <div class="section-title">語氣風格</div>
                            <p style="font-size: 0.9rem; color: var(--gray-700); margin-bottom: 10px;">
                                <strong>親切老師型</strong>為主軸。用「你」稱呼讀者，像在聊天，不是正式報告。把技術術語翻譯成白話文，用比喻和故事解釋複雜概念。
                            </p>
                            <p style="font-size: 0.9rem; color: var(--gray-700);">
                                偶爾穿插<strong>同路人型</strong>，分享「我也遇過這個問題」的經驗，建立同理心。
                            </p>
                        </div>

                        <div class="section">
                            <div class="section-title">專家形象</div>
                            <p style="font-size: 0.9rem; color: var(--gray-700); margin-bottom: 10px;">
                                <strong>入門導師</strong>：把複雜的事講簡單，定位是「我教你怎麼做」。符合你會帶新手的核心能力。
                            </p>
                            <p style="font-size: 0.9rem; color: var(--gray-700);">
                                <strong>實戰教練</strong>：展示真實成效，強調「我做過，有用」。用 Chengxin 10倍成長、CRODER 年增2000詢問這些案例證明。
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 方案 -->
                <div class="card" data-card="products">
                    <div class="card-header">
                        <span class="card-title">方案</span>
                        <span class="card-arrow">→</span>
                    </div>
                    <div class="card-body">
                        <div class="section">
                            <div class="section-title">短期方案（一次性）</div>
                            <div class="product-card">
                                <div class="product-header">
                                    <span class="product-name">SEO 文章策略包</span>
                                    <span class="product-price">$45,000</span>
                                </div>
                                <ul class="product-details">
                                    <li>關鍵字研究（10-15 個目標關鍵字）</li>
                                    <li>10 篇 SEO 優化文章（各 1500-2000 字）</li>
                                    <li>每篇文章 meta、標題優化</li>
                                    <li>內部連結建議</li>
                                    <li>3 個月排名追蹤報告</li>
                                    <li>交付時間：12 週</li>
                                </ul>
                            </div>
                            <div class="product-card">
                                <div class="product-header">
                                    <span class="product-name">6週 SEO 啟動計畫</span>
                                    <span class="product-price">$60,000</span>
                                </div>
                                <ul class="product-details">
                                    <li>Week 1-2：產業競品研究 + 30 關鍵字策略</li>
                                    <li>Week 3-4：技術 SEO 設定 + 網站優化</li>
                                    <li>Week 5-6：3 次線上教學（各 2hr）</li>
                                    <li>交付：50 頁策略報告 + 操作手冊 + 教學錄影</li>
                                    <li>含 3 個月 Email 諮詢 + 排名追蹤</li>
                                </ul>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">長期方案（月費）</div>
                            <div class="product-card">
                                <div class="product-header">
                                    <span class="product-name">A. SEO 顧問方案</span>
                                    <span class="product-price">$12,000/月</span>
                                </div>
                                <ul class="product-details">
                                    <li>每月 2 次線上會議（各 1hr）</li>
                                    <li>每季 1 次完整 SEO 策略報告</li>
                                    <li>每月關鍵字排名追蹤</li>
                                    <li>Email/LINE 諮詢（工作日回覆）</li>
                                </ul>
                            </div>
                            <div class="product-card">
                                <div class="product-header">
                                    <span class="product-name">B. 顧問 + 文章方案</span>
                                    <span class="product-price">$22,000/月</span>
                                </div>
                                <ul class="product-details">
                                    <li>包含 A 方案所有內容</li>
                                    <li>每月 4 篇 SEO 優化文章</li>
                                    <li>含關鍵字研究、撰寫、發布</li>
                                </ul>
                            </div>
                            <div class="product-card">
                                <div class="product-header">
                                    <span class="product-name">C. 全方位代操方案</span>
                                    <span class="product-price">$30,000/月</span>
                                </div>
                                <ul class="product-details">
                                    <li>包含 B 方案所有內容</li>
                                    <li>網站技術持續優化</li>
                                    <li>每月 Landing Page 規劃與優化</li>
                                    <li>競品分析與策略調整</li>
                                    <li>不限時數諮詢（合理範圍）</li>
                                </ul>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">定價原則</div>
                            <ul>
                                <li>顧問時薪目標：$1,000+</li>
                                <li>代操 = 顧問 × 2.5 倍</li>
                                <li>拒絕低於 $10K/月 的顧問</li>
                                <li>拒絕超過營收 25% 的單一客戶</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 內容策略 -->
                <div class="card" data-card="content">
                    <div class="card-header">
                        <span class="card-title">內容策略</span>
                        <span class="card-arrow">→</span>
                    </div>
                    <div class="card-body">
                        <div class="section">
                            <div class="section-title">免費試吃品</div>
                            <ul>
                                <li><strong>PDF 檢查清單</strong> — 「網站 SEO 健康檢查清單」30 個項目，放在文章最後讓讀者下載</li>
                                <li><strong>部落格文章</strong> — 每 2 週 1 篇，建立被動流量與信任資產</li>
                                <li><strong>案例研究</strong> — Chengxin 10倍成長、CRODER 年增2000詢問、Lightwork 3個月首位網路客戶</li>
                                <li><strong>LinkedIn 文章</strong> — 分享實戰經驗與案例，建立專業形象</li>
                            </ul>
                            <div class="alert danger" style="margin-top: 12px;">
                                <strong>已刪除「30分鐘免費諮詢」</strong>— 違反零摩擦原則，吸引佔便宜的人，耗費時間且無法規模化
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">文章主題規劃</div>
                            <p style="font-size: 0.85rem; color: var(--gray-600); margin-bottom: 10px;"><strong>案例型（最重要）</strong></p>
                            <ul>
                                <li>「二手機車行 12 個月流量成長 10 倍 — 老闆從不信到主動加碼的故事」</li>
                                <li>「B2B 單車零件靠內容年增 2000 組詢問」</li>
                                <li>「新創攝影工作室 3 個月拿到第一個網路客戶」</li>
                            </ul>
                            <p style="font-size: 0.85rem; color: var(--gray-600); margin: 14px 0 10px;"><strong>避雷型（點擊率高）</strong></p>
                            <ul>
                                <li>「傳統產業網站常犯的 5 個錯誤」</li>
                                <li>「為什麼你花錢做 SEO 卻沒效果？」</li>
                                <li>「80% 的老闆都踩這 3 個 SEO 的坑」</li>
                            </ul>
                            <p style="font-size: 0.85rem; color: var(--gray-600); margin: 14px 0 10px;"><strong>教學型（展示專業）</strong></p>
                            <ul>
                                <li>「5 個步驟檢查你的網站健康度」</li>
                                <li>「如何用免費工具做關鍵字研究」</li>
                                <li>「新手老闆的 SEO 入門指南」</li>
                            </ul>
                            <p style="font-size: 0.85rem; color: var(--gray-600); margin: 14px 0 10px;"><strong>觀點型（思想領導）</strong></p>
                            <ul>
                                <li>「為什麼傳統產業更適合做 SEO？」</li>
                                <li>「二代接班人該知道的數位轉型真相」</li>
                            </ul>
                        </div>

                        <div class="section">
                            <div class="section-title">CTA 系統</div>
                            <p style="font-size: 0.85rem; color: var(--gray-600); margin-bottom: 10px;"><strong>低門檻（用最多）</strong></p>
                            <ul>
                                <li>「免費下載『網站 SEO 健康檢查清單』」</li>
                                <li>「訂閱電子報，每 2 週收到實戰案例」</li>
                                <li>「追蹤 LinkedIn 看更多 SEO 經驗分享」</li>
                            </ul>
                            <p style="font-size: 0.85rem; color: var(--gray-600); margin: 14px 0 10px;"><strong>中門檻</strong></p>
                            <ul>
                                <li>「對你的狀況有疑問？歡迎 Email 或 LINE 聯繫」</li>
                            </ul>
                            <p style="font-size: 0.85rem; color: var(--gray-600); margin: 14px 0 10px;"><strong>高門檻（只用在服務頁）</strong></p>
                            <ul>
                                <li>「查看完整服務方案與報價」</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: 執行 -->
            <div id="tab-action" class="tab-content">
                <div class="header">
                    <div class="header-label">Action</div>
                    <h1>執行</h1>
                </div>

                <div id="checklist-container">
                    <div class="loading">載入中...</div>
                </div>
            </div>

            <!-- Tab 3: 現況 -->
            <div id="tab-status" class="tab-content">
                <div class="header">
                    <div class="header-label">Status</div>
                    <h1>現況</h1>
                </div>

                <!-- Joe's 10 Items (Pinned) -->
                <div class="pinned">
                    <div class="pinned-label">Joe 的 10 項要求</div>
                    <table class="joe-table" style="color: var(--white);">
                        <thead>
                            <tr style="border-bottom: 1px solid var(--gray-700);">
                                <th style="color: var(--gray-400);">項目</th>
                                <th style="color: var(--gray-400);">狀態</th>
                                <th style="color: var(--gray-400);">說明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid var(--gray-800);">
                                <td>1. 搞清楚市場與痛點</td>
                                <td class="status-good">✓</td>
                                <td style="color: var(--gray-400);">傳統產業+新創，不懂網路但需要客戶</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--gray-800);">
                                <td>2. 優化產品</td>
                                <td class="status-bad">✗</td>
                                <td style="color: var(--gray-400);">設計 3 個規格品：文章包 $45K、啟動計畫 $60K、顧問 $12K/月</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--gray-800);">
                                <td>3. 建立個人品牌</td>
                                <td class="status-bad">✗</td>
                                <td style="color: var(--gray-400);">每 2 週 1 篇文章，累積 12 篇形成信任資產</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--gray-800);">
                                <td>4. 正確發聲</td>
                                <td class="status-bad">✗</td>
                                <td style="color: var(--gray-400);">官網重新定位 + LinkedIn 經營</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--gray-800);">
                                <td>5. 五個流程</td>
                                <td class="status-warning">⚠</td>
                                <td style="color: var(--gray-400);">建立報價、執行、結案的標準 SOP</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--gray-800);">
                                <td>6. 控制客戶組合</td>
                                <td class="status-bad">✗</td>
                                <td style="color: var(--gray-400);">從 4 個分散到 6-8 個，單一客戶 &lt;25%</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--gray-800);">
                                <td>7. 增加利潤控制風險</td>
                                <td class="status-bad">✗</td>
                                <td style="color: var(--gray-400);">CRODER 從 $18K 代操改成 $12K 顧問或 $22K 顧問+文章</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--gray-800);">
                                <td>8. 思考規模擴張</td>
                                <td class="status-warning">⚠</td>
                                <td style="color: var(--gray-400);">6 個月後，月營收穩定 $80K+ 再考慮</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--gray-800);">
                                <td>9. 避免市場侵蝕</td>
                                <td class="status-warning">⚠</td>
                                <td style="color: var(--gray-400);">課程 $4K 與顧問 $12K 內容不同，不會互搶</td>
                            </tr>
                            <tr>
                                <td>10. 保護毛利</td>
                                <td class="status-bad">✗</td>
                                <td style="color: var(--gray-400);">代操必須 = 顧問 × 2.5，否則不接</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 穩定營收 -->
                <div class="metrics-section">
                    <div class="metrics-title">穩定營收</div>
                    <div class="metric-row">
                        <span class="metric-label">MRR（月經常性收入）</span>
                        <span class="metric-value editable" id="metric-mrr" data-key="mrr">$40,000</span>
                    </div>
                    <div id="client-list-preview" style="padding-left: 14px; font-size: 0.8rem; color: var(--gray-500);"></div>
                    <div class="metric-row">
                        <span class="metric-label">月總營收（含一次性）</span>
                        <span class="metric-value editable" id="metric-total" data-key="total-revenue">$40,000</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">vs 上月</span>
                        <span class="metric-value editable" id="metric-vs-last" data-key="vs-last-month">+0%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">目標</span>
                        <span class="target-display">$100,000/月</span>
                    </div>
                </div>

                <!-- 客戶狀況 -->
                <div class="metrics-section">
                    <div class="metrics-title">客戶狀況</div>
                    <div class="metric-row">
                        <span class="metric-label">長期客戶數</span>
                        <span class="metric-value editable" id="metric-long-term" data-key="long-term-clients">4 個</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">專案客戶數</span>
                        <span class="metric-value editable" id="metric-project" data-key="project-clients">0 個</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">本月新增</span>
                        <span class="metric-value editable" id="metric-new" data-key="new-clients">0 個</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">本月流失</span>
                        <span class="metric-value editable" id="metric-lost" data-key="lost-clients">0 個</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">客戶留存率</span>
                        <span class="metric-value editable" id="metric-retention" data-key="retention-rate">100%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">目標</span>
                        <span class="target-display">8 個長期客戶</span>
                    </div>
                </div>

                <!-- 成長指標 -->
                <div class="metrics-section">
                    <div class="metrics-title">成長指標</div>
                    <div class="metric-row">
                        <span class="metric-label">MRR 成長率</span>
                        <span class="metric-value editable" id="metric-mrr-growth" data-key="mrr-growth">+0%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">平均客單價</span>
                        <span class="metric-value editable" id="metric-avg-price" data-key="avg-price">$10,000</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">被動詢問數</span>
                        <span class="metric-value editable" id="metric-inquiries" data-key="inquiries">0 個</span>
                    </div>
                </div>

                <!-- 健康度檢查 -->
                <div class="metrics-section">
                    <div class="metrics-title">健康度檢查</div>
                    <div class="metric-row">
                        <span class="metric-label">最大客戶佔比</span>
                        <span class="metric-value danger" id="metric-max-client">45%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">前兩大佔比</span>
                        <span class="metric-value danger" id="metric-top2">75%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">目標</span>
                        <span class="target-display">最大 &lt;25%，前兩大 &lt;40%</span>
                    </div>
                </div>

                <div class="alert danger">
                    <strong>風險警告：</strong>前兩大客戶佔 75%，遠超過 40% 安全線。CRODER 若離開將損失 45% 營收。
                </div>

                <div class="alert warning" style="margin-top: 10px;">
                    <strong>提醒：</strong>能說 NO 的人，才能真正被客戶所敬重。如果 CRODER 不接受新方案，準備好放手。
                </div>

                <!-- 目前客戶 -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <span class="card-title">目前客戶</span>
                        <span class="card-arrow">→</span>
                    </div>
                    <div class="card-body">
                        <div id="client-list">
                            <div class="loading">載入中...</div>
                        </div>
                        <button class="add-item-btn" onclick="showAddClientModal()">+ 新增客戶</button>
                    </div>
                </div>

                <!-- 信任資產 -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">信任資產</span>
                        <span class="card-arrow">→</span>
                    </div>
                    <div class="card-body">
                        <div class="metric-row">
                            <span class="metric-label">A. 清晰印象</span>
                            <span class="status-bad">✗</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">B. 頭銜認證</span>
                            <span class="status-bad">✗</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">C. 驚人經歷</span>
                            <span class="status-good">✓</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">D. 用戶見證</span>
                            <span class="status-good">✓</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">E. 高價商品</span>
                            <span class="status-warning">⚠</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 4: 討論 -->
            <div id="tab-discuss" class="tab-content">
                <div class="header">
                    <div class="header-label">Discuss</div>
                    <h1>討論</h1>
                </div>

                <div class="discuss-card">
                    <div class="discuss-title">有問題想討論？</div>
                    <div class="discuss-desc">
                        點擊下方按鈕打開 Claude<br>
                        我已經記得你的事業計畫背景<br>
                        直接問問題就可以了
                    </div>
                    <a href="claude://chat/1fa1842b-4337-4c49-b042-52fa971cbe84" class="discuss-btn" id="discuss-btn">
                        打開 Claude
                    </a>
                    <div class="discuss-note">
                        會開啟 Claude App
                    </div>
                </div>
            </div>
        </main>

        <nav class="tab-bar">
            <div class="tab-item active" data-tab="tab-strategy">策略</div>
            <div class="tab-item" data-tab="tab-action">執行</div>
            <div class="tab-item" data-tab="tab-status">現況</div>
            <div class="tab-item" data-tab="tab-discuss">討論</div>
        </nav>
    </div>

    <!-- Modal for adding/editing -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal">
            <div class="modal-title" id="modal-title">新增項目</div>
            <input type="text" class="modal-input" id="modal-input-1" placeholder="">
            <input type="text" class="modal-input" id="modal-input-2" placeholder="" style="display:none;">
            <select class="modal-input" id="modal-select" style="display:none;">
                <option value="phase1-week1">Phase 1 - Week 1</option>
                <option value="phase1-week2">Phase 1 - Week 2</option>
                <option value="phase1-week3">Phase 1 - Week 3</option>
                <option value="phase1-week4">Phase 1 - Week 4</option>
                <option value="phase2">Phase 2</option>
                <option value="phase3">Phase 3</option>
            </select>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">取消</button>
                <button class="modal-btn primary" id="modal-confirm">確認</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase setup
        const SUPABASE_URL = 'https://dpmgdtevrrlmtkneyzkg.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRwbWdkdGV2cnJsbXRrbmV5emtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4MzU2NjIsImV4cCI6MjA4MjQxMTY2Mn0.i3Zr_09kTkdLbKT0CU1xgQz2raqaNKhf8Bqds7qX2Ew';
        const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Tab switching
        const tabItems = document.querySelectorAll('.tab-item');
        const tabContents = document.querySelectorAll('.tab-content');

        tabItems.forEach(item => {
            item.addEventListener('click', () => {
                const tabId = item.dataset.tab;
                tabItems.forEach(t => t.classList.remove('active'));
                item.classList.add('active');
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId) {
                        content.classList.add('active');
                        document.querySelector('.main-content').scrollTop = 0;
                    }
                });
            });
        });

        // Card accordion
        document.querySelectorAll('.card').forEach(card => {
            const header = card.querySelector('.card-header');
            if (header) {
                header.addEventListener('click', () => {
                    card.classList.toggle('open');
                });
            }
        });

        // ===== CHECKLIST FUNCTIONS =====
        async function loadChecklist() {
            const container = document.getElementById('checklist-container');
            
            const { data, error } = await db
                .from('checklist')
                .select('*')
                .order('sort_order', { ascending: true });

            if (error) {
                console.error('Error loading checklist:', error);
                container.innerHTML = '<p>載入失敗，請重新整理</p>';
                return;
            }

            // If empty, initialize with default data
            if (!data || data.length === 0) {
                await initializeChecklist();
                loadChecklist();
                return;
            }

            renderChecklist(data);
        }

        async function initializeChecklist() {
            const defaultItems = [
                { phase: 'phase1', week: 'week1', text: '跟 CRODER 約會議討論新方案', sort_order: 1 },
                { phase: 'phase1', week: 'week1', text: '準備 CRODER 年度成效報告', sort_order: 2 },
                { phase: 'phase1', week: 'week2', text: 'CRODER 正式提案（$12K 或 $22K 方案）', sort_order: 3 },
                { phase: 'phase1', week: 'week2', text: '修改網站首頁大標與副標', sort_order: 4 },
                { phase: 'phase1', week: 'week3', text: '修改「關於我們」頁面', sort_order: 5 },
                { phase: 'phase1', week: 'week3', text: '寫第一篇文章（Chengxin 案例）', sort_order: 6 },
                { phase: 'phase1', week: 'week4', text: '向 Chengxin 提案 $15K 方案', sort_order: 7 },
                { phase: 'phase1', week: 'week4', text: '重新設計服務與價格頁面', sort_order: 8 },
                { phase: 'phase2', week: null, text: '發布 4 篇部落格文章', sort_order: 10 },
                { phase: 'phase2', week: null, text: '製作「SEO 健康檢查清單」PDF', sort_order: 11 },
                { phase: 'phase2', week: null, text: 'LinkedIn 累積 50+ 連結', sort_order: 12 },
                { phase: 'phase2', week: null, text: '發布 8 篇部落格文章（累計）', sort_order: 13 },
                { phase: 'phase2', week: null, text: '開第一場課程（10人目標）', sort_order: 14 },
                { phase: 'phase2', week: null, text: '賣出 1 個文章包或啟動計畫', sort_order: 15 },
                { phase: 'phase2', week: null, text: '客戶數增加到 6 個', sort_order: 16 },
                { phase: 'phase3', week: null, text: '月營收達到 $80,000', sort_order: 20 },
                { phase: 'phase3', week: null, text: '發布 12 篇部落格文章（累計）', sort_order: 21 },
                { phase: 'phase3', week: null, text: '開過 2 場課程（累計）', sort_order: 22 },
                { phase: 'phase3', week: null, text: '每月有 3-5 個陌生詢問', sort_order: 23 },
                { phase: 'phase3', week: null, text: '單一客戶不超過 20%', sort_order: 24 },
                { phase: 'phase3', week: null, text: '月營收達到 $100,000', sort_order: 25 },
                { phase: 'phase3', week: null, text: '客戶數增加到 8 個', sort_order: 26 },
            ];

            await db.from('checklist').insert(defaultItems);
        }

        function renderChecklist(items) {
            const container = document.getElementById('checklist-container');
            
            const phases = {
                phase1: { title: '基礎建立', weeks: { week1: [], week2: [], week3: [], week4: [] } },
                phase2: { title: '內容累積（Month 2-3）', items: [] },
                phase3: { title: '規模成長（Month 4-6）', items: [] }
            };

            items.forEach(item => {
                if (item.phase === 'phase1' && item.week) {
                    phases.phase1.weeks[item.week].push(item);
                } else if (phases[item.phase]) {
                    if (phases[item.phase].items) {
                        phases[item.phase].items.push(item);
                    }
                }
            });

            let html = '';

            // Phase 1 with weeks
            html += `
                <div class="phase">
                    <div class="phase-header">
                        <span class="phase-badge">PHASE 1</span>
                        <span class="phase-title">基礎建立（Week 1-4）</span>
                    </div>
            `;

            ['week1', 'week2', 'week3', 'week4'].forEach((week, idx) => {
                html += `
                    <div class="week-group">
                        <div class="week-label">Week ${idx + 1}</div>
                        ${phases.phase1.weeks[week].map(item => renderChecklistItem(item)).join('')}
                        <button class="add-item-btn" onclick="showAddChecklistModal('phase1-${week}')">+ 新增</button>
                    </div>
                `;
            });

            html += `</div>`;

            // Phase 2
            html += `
                <div class="phase">
                    <div class="phase-header">
                        <span class="phase-badge">PHASE 2</span>
                        <span class="phase-title">${phases.phase2.title}</span>
                    </div>
                    ${phases.phase2.items.map(item => renderChecklistItem(item)).join('')}
                    <button class="add-item-btn" onclick="showAddChecklistModal('phase2')">+ 新增</button>
                </div>
            `;

            // Phase 3
            html += `
                <div class="phase">
                    <div class="phase-header">
                        <span class="phase-badge">PHASE 3</span>
                        <span class="phase-title">${phases.phase3.title}</span>
                    </div>
                    ${phases.phase3.items.map(item => renderChecklistItem(item)).join('')}
                    <button class="add-item-btn" onclick="showAddChecklistModal('phase3')">+ 新增</button>
                </div>
            `;

            container.innerHTML = html;

            // Add event listeners
            container.querySelectorAll('.checklist-item').forEach(el => {
                el.addEventListener('click', async (e) => {
                    if (e.target.classList.contains('checklist-delete')) return;
                    const id = el.dataset.id;
                    const isDone = el.classList.contains('done');
                    el.classList.toggle('done');
                    await db.from('checklist').update({ done: !isDone }).eq('id', id);
                });
            });

            container.querySelectorAll('.checklist-delete').forEach(el => {
                el.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    const id = el.dataset.id;
                    if (confirm('確定要刪除這個項目嗎？')) {
                        await db.from('checklist').delete().eq('id', id);
                        loadChecklist();
                    }
                });
            });
        }

        function renderChecklistItem(item) {
            return `
                <div class="checklist-item ${item.done ? 'done' : ''}" data-id="${item.id}">
                    <div class="checkbox">✓</div>
                    <div class="checklist-text">${item.text}</div>
                    <span class="checklist-delete" data-id="${item.id}">✕</span>
                </div>
            `;
        }

        // ===== CLIENT FUNCTIONS =====
        async function loadClients() {
            const { data, error } = await db
                .from('clients')
                .select('*')
                .order('amount', { ascending: false });

            if (error) {
                console.error('Error loading clients:', error);
                return;
            }

            // If empty, initialize with default data
            if (!data || data.length === 0) {
                await initializeClients();
                loadClients();
                return;
            }

            renderClients(data);
        }

        async function initializeClients() {
            const defaultClients = [
                { name: 'CRODER', amount: 18000, type: 'long-term' },
                { name: 'UBOX', amount: 12000, type: 'long-term' },
                { name: 'Chengxin', amount: 6000, type: 'long-term' },
                { name: 'Lightwork', amount: 4000, type: 'long-term' },
            ];

            await db.from('clients').insert(defaultClients);
        }

        function renderClients(clients) {
            const container = document.getElementById('client-list');
            const previewContainer = document.getElementById('client-list-preview');
            
            const total = clients.reduce((sum, c) => sum + c.amount, 0);
            
            let html = '';
            let previewHtml = '';
            
            clients.forEach((client, idx) => {
                const percent = total > 0 ? Math.round(client.amount / total * 100) : 0;
                const isDanger = percent > 25;
                
                html += `
                    <div class="client-item">
                        <span class="client-name">${client.name}</span>
                        <span>
                            <span class="client-amount">$${client.amount.toLocaleString()}</span>
                            <span class="client-percent ${isDanger ? 'danger' : ''}">(${percent}%)</span>
                            <span class="checklist-delete" onclick="deleteClient('${client.id}')" style="margin-left: 8px;">✕</span>
                        </span>
                    </div>
                `;
                
                previewHtml += `<div style="padding: 2px 0;">— ${client.name}: $${client.amount.toLocaleString()}</div>`;
            });

            container.innerHTML = html;
            previewContainer.innerHTML = previewHtml;

            // Update health metrics
            if (clients.length > 0) {
                const maxPercent = Math.round(clients[0].amount / total * 100);
                const top2Percent = clients.length > 1 
                    ? Math.round((clients[0].amount + clients[1].amount) / total * 100)
                    : maxPercent;

                document.getElementById('metric-max-client').textContent = maxPercent + '%';
                document.getElementById('metric-max-client').className = 'metric-value ' + (maxPercent > 25 ? 'danger' : 'success');
                
                document.getElementById('metric-top2').textContent = top2Percent + '%';
                document.getElementById('metric-top2').className = 'metric-value ' + (top2Percent > 40 ? 'danger' : 'success');
            }
        }

        async function deleteClient(id) {
            if (confirm('確定要刪除這個客戶嗎？')) {
                await db.from('clients').delete().eq('id', id);
                loadClients();
            }
        }

        // ===== METRICS FUNCTIONS =====
        async function loadMetrics() {
            const { data, error } = await db.from('metrics').select('*');
            
            if (data) {
                data.forEach(metric => {
                    const el = document.querySelector(`[data-key="${metric.key}"]`);
                    if (el) {
                        el.textContent = metric.value;
                    }
                });
            }

            // Add click handlers for editable metrics
            document.querySelectorAll('.metric-value.editable').forEach(el => {
                el.addEventListener('click', () => {
                    showEditMetricModal(el.dataset.key, el.textContent);
                });
            });
        }

        async function saveMetric(key, value) {
            const { error } = await db
                .from('metrics')
                .upsert({ key, value, updated_at: new Date().toISOString() }, { onConflict: 'key' });
            
            if (!error) {
                const el = document.querySelector(`[data-key="${key}"]`);
                if (el) el.textContent = value;
            }
        }

        // ===== MODAL FUNCTIONS =====
        let currentModalType = null;
        let currentModalData = null;

        function showModal() {
            document.getElementById('modal-overlay').classList.add('show');
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.remove('show');
            document.getElementById('modal-input-1').value = '';
            document.getElementById('modal-input-2').value = '';
            currentModalType = null;
            currentModalData = null;
        }

        function showAddChecklistModal(phaseWeek) {
            currentModalType = 'add-checklist';
            currentModalData = phaseWeek;
            
            document.getElementById('modal-title').textContent = '新增待辦事項';
            document.getElementById('modal-input-1').placeholder = '輸入待辦事項內容';
            document.getElementById('modal-input-1').style.display = 'block';
            document.getElementById('modal-input-2').style.display = 'none';
            document.getElementById('modal-select').style.display = 'none';
            
            document.getElementById('modal-confirm').onclick = addChecklistItem;
            showModal();
        }

        async function addChecklistItem() {
            const text = document.getElementById('modal-input-1').value.trim();
            if (!text) return;

            let phase, week;
            if (currentModalData.startsWith('phase1-')) {
                phase = 'phase1';
                week = currentModalData.replace('phase1-', '');
            } else {
                phase = currentModalData;
                week = null;
            }

            await db.from('checklist').insert({
                phase,
                week,
                text,
                done: false,
                sort_order: 100
            });

            closeModal();
            loadChecklist();
        }

        function showAddClientModal() {
            currentModalType = 'add-client';
            
            document.getElementById('modal-title').textContent = '新增客戶';
            document.getElementById('modal-input-1').placeholder = '客戶名稱';
            document.getElementById('modal-input-1').style.display = 'block';
            document.getElementById('modal-input-2').placeholder = '月費金額（數字）';
            document.getElementById('modal-input-2').style.display = 'block';
            document.getElementById('modal-select').style.display = 'none';
            
            document.getElementById('modal-confirm').onclick = addClient;
            showModal();
        }

        async function addClient() {
            const name = document.getElementById('modal-input-1').value.trim();
            const amount = parseInt(document.getElementById('modal-input-2').value.trim());
            
            if (!name || isNaN(amount)) return;

            await db.from('clients').insert({
                name,
                amount,
                type: 'long-term'
            });

            closeModal();
            loadClients();
        }

        function showEditMetricModal(key, currentValue) {
            currentModalType = 'edit-metric';
            currentModalData = key;
            
            document.getElementById('modal-title').textContent = '編輯數值';
            document.getElementById('modal-input-1').placeholder = '輸入新數值';
            document.getElementById('modal-input-1').value = currentValue;
            document.getElementById('modal-input-1').style.display = 'block';
            document.getElementById('modal-input-2').style.display = 'none';
            document.getElementById('modal-select').style.display = 'none';
            
            document.getElementById('modal-confirm').onclick = async () => {
                const value = document.getElementById('modal-input-1').value.trim();
                if (value) {
                    await saveMetric(currentModalData, value);
                }
                closeModal();
            };
            showModal();
        }

        // ===== DISCUSS LINK =====
        // Try to open app, fallback to web
        document.getElementById('discuss-btn').addEventListener('click', function(e) {
            const webUrl = 'https://claude.ai/chat/1fa1842b-4337-4c49-b042-52fa971cbe84';
            
            // Try app URL scheme first
            window.location.href = 'claude://chat/1fa1842b-4337-4c49-b042-52fa971cbe84';
            
            // Fallback to web after delay
            setTimeout(() => {
                window.open(webUrl, '_blank');
            }, 500);
            
            e.preventDefault();
        });

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            loadChecklist();
            loadClients();
            loadMetrics();
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {});
        }
    </script>
</body>
</html>
